<!DOCTYPE html>
<html lang="ko" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{view/layout/layout}">
<head>
    <meta charset="UTF-8">
    <title>Í≤åÏãúÍ∏Ä ÏÉÅÏÑ∏Î≥¥Í∏∞</title>
    <script src="/js/postDetail.js" type="module" defer></script>
    <style>
        #likeButton.liked {
            background-color: magenta;
            color: white;
            border-color: magenta;
        }
    </style>
</head>
<body class="bg-gray-100 flex flex-col items-center min-h-screen">
<div layout:fragment="content" class="container max-w-screen-lg mx-auto mt-4 p-6 bg-white rounded-lg shadow-lg">
        <div class="post-detail">
            <!-- Í≤åÏãúÍ∏Ä ID (Ïà®ÍπÄ Ï≤òÎ¶¨) -->
            <div id="postId" hidden="hidden" th:text="${postDetail.postId}">0</div>

            <div class="flex justify-between items-start mb-4">
                <!-- Í≤åÏãúÍ∏Ä Ï†úÎ™© -->
                <h1 th:text="${postDetail.title}" class="text-3xl font-bold mb-4">Post Title</h1>

                <!-- ÏÇºÏ†ê Î≤ÑÌäº - ÏûëÏÑ±ÏûêÎÇò ADMINÎßå Î≥º Ïàò ÏûàÎèÑÎ°ù ÏÑ§Ï†ï -->
                <div th:if="${(role != null and role == 'ADMIN') or (nickname != null and nickname == postDetail.author)}"
                     class="dropdown dropdown-end">
                    <button tabindex="0" class="btn btn-ghost btn-circle">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z">
                            </path>
                        </svg>
                    </button>
                    <ul tabindex="0" class="dropdown-content menu p-2 shadow bg-base-100 rounded-box w-52">
                        <form th:action="@{/choose/{id}(id=${postDetail.postId})}" method="get">
                            <li th:if="${nickname != null and nickname == postDetail.author}">
                                <button class="w-full text-left">Í∞ÑÌÉùÌïòÍ∏∞</button>
                            </li>
                        </form>
                        <form th:action="@{'/post/updateView/'+${postDetail.postId}}" method="get">
                            <li>
                                <button class="w-full text-left">Í≤åÏãúÍ∏Ä ÏàòÏ†ï</button>
                            </li>
                        </form>
                        <form th:action="@{'/post/delete/'+${postDetail.postId}}" method="post">
                            <li>
                                <button class="w-full text-left text-error">Í≤åÏãúÍ∏Ä ÏÇ≠Ï†ú</button>
                            </li>
                        </form>
                    </ul>
                </div>
            </div>

            <!-- Í≤åÏãúÍ∏Ä ÏûëÏÑ±Ïûê Î∞è ÏûëÏÑ± ÏãúÍ∞Ñ -->
            <div class="post-info flex items-center text-gray-600 mb-6">
                <span th:text="${postDetail.author}" class="mr-4">ÏûëÏÑ±Ïûê</span>
                <span th:text="${#temporals.format(postDetail.createdAt, 'yyyy-MM-dd HH:mm')}">ÏûëÏÑ± ÏãúÍ∞Ñ</span>
            </div>

            <!-- Í≤åÏãúÍ∏Ä ÎÇ¥Ïö© -->
            <div class="post-content mb-6">
                <p th:text="${postDetail.text}" class="text-gray-700 leading-relaxed break-words">Î≥∏Î¨∏ ÎÇ¥Ïö©</p>
            </div>

            <!-- Í≤åÏãúÍ∏Ä ÏÑ§Î™Ö -->
            <div class="post-description mb-6">
                <p th:text="${postDetail.description}" class="text-gray-600 break-words">ÏÑ§Î™Ö ÎÇ¥Ïö©</p>
            </div>

            <!-- Ïï°ÏÖò Î≤ÑÌäºÎì§ -->
            <div class="actions flex items-center space-x-4 mb-8">
                <button id="likeButton" class="btn btn-outline btn-success btn-sm"
                        th:classappend = "${isLike} ? 'liked' : ''">
                    üëç <span id="likeCount" th:text="${postDetail.likeCount}"></span>
                </button>
            </div>




            <!-- ÎåìÍ∏Ä ÏûÖÎ†• Ìèº -->
            <div class="comment-form mb-8">
                <form th:action="@{/post/comment/{id}(id=${postDetail.postId})}" method="post" class="space-y-4">
                    <textarea name="content" placeholder="Add a Comment" required
                              class="textarea textarea-bordered w-full bg-white"></textarea>
                    <button type="submit" class="btn btn-primary w-full">ÎåìÍ∏Ä Îì±Î°ù</button>
                </form>
            </div>

            <!-- ÎåìÍ∏Ä Î™©Î°ù -->
            <div class="comment-list">
                <h2 class="text-2xl font-semibold mb-4">ÎåìÍ∏Ä Î™©Î°ù</h2>
                <ul class="space-y-6">
                    <!-- ÎåìÍ∏ÄÏù¥ ÏûàÎäî Í≤ΩÏö∞ Ï∂úÎ†• -->
                    <li class="comment-item bg-gray-100 p-4 rounded-lg shadow-sm"
                        th:each="comment : ${postDetail.comments}" th:if="${postDetail.comments.size() > 0}"
                        th:attr="data-comment-id=${comment.getCommentId()}">
                        <div>
                            <div id="commentId" hidden="hidden" th:text="${comment.getCommentId()}"></div>
                            <p class="comment-author font-bold text-gray-700 mb-2" th:text="${comment.member.nickname}">ÏûëÏÑ±Ïûê</p>
                            <p class="comment-content text-gray-600 mb-2" th:text="${comment.content}">ÎåìÍ∏Ä ÎÇ¥Ïö©</p>
                            <p class="comment-date text-sm text-gray-500" th:text="${#temporals.format(comment.createdAt, 'yyyy-MM-dd HH:mm')}">ÏûëÏÑ± ÏãúÍ∞Ñ</p>
                            <div class="comment-actions flex space-x-4 mt-2">
                                <!-- ÏàòÏ†ï Î≤ÑÌäº -->
                                <button class="btn btn-primary btn-sm edit-comment-btn"
                                        th:attr="data-comment-id=${comment.getCommentId()}">ÏàòÏ†ï</button>
                                <!-- ÏÇ≠Ï†ú Î≤ÑÌäº -->
                                <button class="btn btn-primary btn-sm delete-comment-btn"
                                        th:attr="data-comment-id=${comment.getCommentId()}">ÏÇ≠Ï†ú</button>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
</div>
</body>
</html>
